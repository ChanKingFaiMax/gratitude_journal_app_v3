# 产品需求文档：洞察功能网页端输出

**文档版本**：v1.0  
**创建日期**：2026年1月6日  
**作者**：Manus AI  
**项目**：感恩日记 (Gratitude Journal App)

---

## 一、产品背景

感恩日记应用目前已在移动端实现了五大核心洞察功能，通过AI分析用户的日记内容，提供深度的心理和意识层面的反馈。这些洞察功能包括人物关系分析、意识层级评估、成长轨迹追踪、正念提醒和内在矛盾梳理。为了扩大用户触达范围，提升用户体验的完整性，我们计划将洞察功能输出到网页端，让用户可以在桌面浏览器中查看和管理自己的洞察报告。

---

## 二、产品目标

### 2.1 核心目标

本次网页端输出的核心目标是**将移动端的五大洞察功能完整迁移到网页端**，确保用户在不同设备上都能获得一致的洞察体验。具体包括：

- **跨平台一致性**：网页端与移动端的洞察内容、UI设计、交互逻辑保持高度一致
- **桌面优化体验**：充分利用桌面端的大屏幕优势，提供更丰富的数据可视化和更舒适的阅读体验
- **数据同步**：确保用户在移动端和网页端查看的洞察数据实时同步，基于相同的日记内容生成

### 2.2 业务价值

- **提升用户留存**：用户可以在办公室或家中通过电脑深度查看洞察报告，增加使用场景
- **增强产品竞争力**：提供全平台覆盖的洞察服务，区别于仅支持移动端的竞品
- **提高转化率**：桌面端更适合展示复杂的图表和长文本，有助于用户理解洞察价值，提升付费转化

---

## 三、用户画像与使用场景

### 3.1 目标用户

| 用户类型 | 特征描述 | 使用动机 |
|---------|---------|---------|
| **深度用户** | 每周写3篇以上日记，关注个人成长和心理健康 | 希望在大屏幕上深度查看洞察报告，进行自我反思 |
| **职场用户** | 白天在办公室工作，习惯使用电脑 | 午休或下班后在电脑上查看洞察，避免手机分心 |
| **数据分析爱好者** | 喜欢量化自我，关注数据趋势和可视化 | 希望在桌面端查看更详细的图表和历史数据对比 |

### 3.2 典型使用场景

**场景1：周末深度回顾**

用户在周末晚上打开电脑，登录网页端，查看本周的"我的成长"洞察。通过大屏幕上的意识层级曲线图，用户清晰地看到自己本周从"恐惧"层级逐步提升到"接纳"层级，感受到成长的轨迹，获得继续写日记的动力。

**场景2：办公室午休自我觉察**

用户在办公室午休时，打开网页端查看"我近期可以注意的"洞察。AI基于正念理论，提醒用户关注工作中的焦虑情绪。用户在电脑上阅读完整的洞察文案，记下几条实践建议，下午工作时更有觉知。

**场景3：导出洞察报告分享**

用户在网页端查看"如何梳理我的内在矛盾"洞察后，觉得内容很有价值，点击"导出为PDF"按钮，将报告保存到本地，发送给心理咨询师作为咨询前的参考资料。

---

## 四、功能需求

### 4.1 功能架构

网页端洞察功能的整体架构如下：

```
网页端洞察功能
├── 洞察入口页面
│   ├── 五大洞察卡片展示
│   ├── 最近更新时间显示
│   └── 快速刷新按钮
├── 洞察详情页面
│   ├── 洞察标题与副标题
│   ├── 刷新按钮（无冷却限制）
│   ├── AI思考过程展示（可折叠）
│   ├── 洞察内容展示
│   │   ├── 人物关系分析
│   │   ├── 意识层级评估
│   │   ├── 成长轨迹追踪（含图表）
│   │   ├── 正念提醒
│   │   └── 内在矛盾梳理
│   └── 操作按钮
│       ├── 导出为PDF
│       ├── 分享链接
│       └── 查看历史版本
└── 洞察历史页面
    ├── 历史记录列表
    ├── 时间筛选器
    └── 版本对比功能
```

### 4.2 核心功能详细说明

#### 4.2.1 洞察入口页面

**功能描述**：用户登录网页端后，在导航栏或侧边栏点击"洞察"入口，进入洞察入口页面。页面展示五大洞察类型的卡片，每个卡片显示洞察名称、图标、副标题和最近更新时间。

**交互逻辑**：
- 用户点击任意卡片，跳转到对应的洞察详情页面
- 卡片右上角显示"刷新"图标，点击后重新生成该洞察（无冷却限制）
- 如果某个洞察尚未生成，卡片显示"生成洞察"按钮

**UI设计要点**：
- 采用卡片式布局，每行2-3个卡片（根据屏幕宽度自适应）
- 卡片配色与移动端保持一致（人物关系红色、意识层级金色等）
- 鼠标悬停时卡片轻微放大，增加交互反馈

#### 4.2.2 洞察详情页面

**功能描述**：展示某个洞察类型的完整分析内容，包括标题、副标题、AI思考过程、洞察正文、数据可视化图表等。

**交互逻辑**：
- 页面顶部显示返回按钮和刷新按钮
- 刷新按钮点击后，显示加载动画和"AI正在深度思考..."提示
- AI思考过程默认折叠，用户点击"查看AI思考过程"按钮展开
- 洞察内容根据类型不同，展示不同的结构（详见4.3节）
- 页面底部显示"导出为PDF"和"分享链接"按钮

**UI设计要点**：
- 采用居中单栏布局，最大宽度800px，确保阅读舒适性
- 标题使用大字号（32px），副标题使用小字号（14px）并配色
- 洞察内容使用卡片式分段展示，每个卡片有圆角和阴影
- 图表采用响应式设计，适配不同屏幕宽度

#### 4.2.3 成长轨迹图表（重点功能）

**功能描述**：在"我的成长"洞察中，展示用户意识层级的变化趋势图。根据日记的时间跨度，智能切换显示模式：

- **跨天模式（时间跨度≥2天）**：显示时间曲线图，X轴为日期，Y轴为意识层级分数，展示长期成长趋势
- **同天模式（时间跨度<2天）**：显示阶梯式上升图，X轴为"第1篇、第2篇、第3篇"，展示当天写作中的意识转化过程

**交互逻辑**：
- 用户鼠标悬停在数据点上，显示tooltip，展示该日记的意识层级、层级名称和日期
- 图表下方显示文案总结，如"13天成长轨迹：从恐惧(280)到接纳(350)，提升70分"
- 用户可以点击图表右上角的"查看详细数据"按钮，展开表格查看每篇日记的详细信息

**技术实现**：
- 前端使用Chart.js或Recharts库绘制图表
- 后端API返回日记列表，包含timestamp、consciousnessLevel、levelName字段
- 前端根据timestamp计算时间跨度，决定显示哪种图表

#### 4.2.4 导出为PDF功能

**功能描述**：用户点击"导出为PDF"按钮后，系统将当前洞察详情页面的内容（包括标题、副标题、洞察正文、图表）导出为PDF文件，保存到用户本地。

**交互逻辑**：
- 点击按钮后，显示"正在生成PDF..."加载提示
- 生成完成后，浏览器自动下载PDF文件，文件名格式为"洞察_[类型]_[日期].pdf"（如"洞察_我的成长_20260106.pdf"）
- 如果生成失败，显示错误提示"PDF生成失败，请稍后重试"

**技术实现**：
- 前端使用html2canvas将页面内容转为图片，再使用jsPDF生成PDF
- 或者后端提供PDF生成API，前端传递洞察数据，后端使用Puppeteer或WeasyPrint生成PDF

#### 4.2.5 洞察历史页面

**功能描述**：用户可以查看某个洞察类型的历史版本，对比不同时间点的分析结果，观察自己认知的变化。

**交互逻辑**：
- 用户在洞察详情页面点击"查看历史版本"按钮，跳转到历史页面
- 历史页面展示该洞察类型的所有历史记录，按时间倒序排列
- 用户可以选择两个版本进行对比，系统高亮显示差异部分
- 用户可以点击某个历史版本，查看完整内容

**UI设计要点**：
- 历史记录采用时间轴布局，每个节点显示生成日期和简短摘要
- 对比模式采用左右分栏布局，差异部分用不同颜色标注

### 4.3 五大洞察类型的内容结构

#### 4.3.1 我的人物关系

**展示内容**：
- 总结段落：基于日记内容，总结用户生命中最重要的人
- 人物列表：每个人物显示姓名、emoji头像、提及次数、感恩内容
- 爱的洞察：一段鼓励性的文案，强调关系的价值

**数据来源**：
- API：`/api/trpc/ai.generateReviewAnalysis`，参数`type: 'relationships'`
- 返回字段：`summary`, `people[]`, `insight`

#### 4.3.2 我的意识层级

**展示内容**：
- 整体意识层级：显示平均分数、层级名称（如"接纳"）
- 意识层级分布：低维度、中维度、高维度的占比（饼图或柱状图）
- 代表性语句：从日记中提取的高意识层级语句和低意识层级语句
- 提升建议：AI给出的意识层级提升建议

**数据来源**：
- API：`/api/trpc/ai.generateReviewAnalysis`，参数`type: 'consciousness'`
- 返回字段：`overallLevel`, `levelName`, `distribution`, `highLevelPhrases[]`, `lowLevelPhrases[]`, `advice`

#### 4.3.3 我的成长

**展示内容**：
- 当前意识层级：显示最新的意识层级分数和层级名称
- 成长轨迹图表：根据时间跨度显示曲线图或阶梯图（详见4.2.3）
- 成长旅程描述：3-4句话描述用户的成长历程
- 关键转变：列出2-3个关键的意识层级转变点
- 鼓励文案：温暖、专业的鼓励语句

**数据来源**：
- API：`/api/trpc/ai.generateReviewAnalysis`，参数`type: 'growth'`
- 返回字段：`currentLevel`, `levelName`, `journey`, `shifts[]`, `encouragement`, `levelBreakdown`

#### 4.3.4 我近期可以注意的

**展示内容**：
- 正念提醒列表：3-5条基于正念理论的实践建议
- 每条提醒包含：emoji图标、标题、详细说明
- 底部显示一段总结性的鼓励文案

**数据来源**：
- API：`/api/trpc/ai.generateReviewAnalysis`，参数`type: 'attention'`
- 返回字段：`reminders[]`, `summary`

#### 4.3.5 如何梳理我的内在矛盾

**展示内容**：
- 内在矛盾列表：识别出的2-3组内在矛盾
- 每组矛盾包含：矛盾描述、产生原因、整合建议
- 内在矛盾强度图：显示不同矛盾的强度分布（柱状图）
- 荣格视角总结：一段基于荣格心理学的整合性文案

**数据来源**：
- API：`/api/trpc/ai.generateReviewAnalysis`，参数`type: 'conflicts'`
- 返回字段：`conflicts[]`, `integrationAdvice`, `jungianSummary`

---

## 五、技术方案

### 5.1 技术架构

网页端洞察功能的技术架构如下：

```
前端（React + TypeScript）
├── 页面层
│   ├── InsightsHomePage（洞察入口页面）
│   ├── InsightDetailPage（洞察详情页面）
│   └── InsightHistoryPage（洞察历史页面）
├── 组件层
│   ├── InsightCard（洞察卡片）
│   ├── GrowthChart（成长图表）
│   ├── ConsciousnessDistribution（意识分布图）
│   └── ConflictIntensityChart（矛盾强度图）
├── 数据层
│   ├── tRPC Client（调用后端API）
│   └── React Query（数据缓存与状态管理）
└── 工具层
    ├── html2canvas + jsPDF（PDF导出）
    └── Chart.js / Recharts（图表绘制）

后端（Node.js + Express + tRPC）
├── API层
│   └── ai.generateReviewAnalysis（已有，复用移动端API）
├── 缓存层
│   └── Redis（缓存洞察结果，避免重复生成）
└── 数据库层
    └── PostgreSQL（存储日记和洞察历史）
```

### 5.2 关键技术点

#### 5.2.1 数据同步

**问题**：如何确保网页端和移动端查看的洞察数据一致？

**解决方案**：
- 移动端和网页端共用同一套后端API（`ai.generateReviewAnalysis`）
- 洞察结果基于日记内容的哈希值进行缓存，只要日记内容不变，返回相同的洞察结果
- 用户在任意端刷新洞察时，清除缓存，重新生成最新结果

#### 5.2.2 响应式设计

**问题**：如何在不同屏幕尺寸下提供良好的体验？

**解决方案**：
- 采用响应式布局，使用CSS Grid或Flexbox
- 图表使用响应式库（如Recharts），自动适配容器宽度
- 移动端访问网页时，自动切换为移动端优化布局（单栏、大字号）

#### 5.2.3 PDF导出

**问题**：如何将包含图表的洞察页面导出为高质量PDF？

**解决方案**：
- **方案1（前端生成）**：使用html2canvas将页面转为Canvas，再用jsPDF生成PDF。优点是无需后端支持，缺点是图表可能失真。
- **方案2（后端生成）**：前端调用后端API，传递洞察数据，后端使用Puppeteer渲染HTML并生成PDF。优点是质量高，缺点是增加服务器负载。
- **推荐方案**：优先使用方案1，如果用户反馈质量不佳，再切换到方案2。

#### 5.2.4 性能优化

**问题**：洞察生成依赖AI调用，可能耗时较长，如何优化用户体验？

**解决方案**：
- 使用React Query的`useQuery`缓存洞察结果，避免重复请求
- 显示加载动画和"AI正在深度思考..."提示，降低用户等待焦虑
- 后端使用Redis缓存洞察结果，基于日记内容哈希值判断是否需要重新生成
- 对于历史版本查询，直接从数据库读取，无需调用AI

---

## 六、非功能需求

### 6.1 性能要求

| 指标 | 目标值 | 说明 |
|-----|-------|-----|
| 页面加载时间 | < 2秒 | 洞察入口页面首次加载时间 |
| 洞察生成时间 | < 10秒 | AI生成洞察的平均时间 |
| 图表渲染时间 | < 1秒 | 成长图表从数据到渲染完成的时间 |
| PDF导出时间 | < 5秒 | 从点击按钮到下载完成的时间 |

### 6.2 兼容性要求

| 浏览器 | 最低版本 | 说明 |
|-------|---------|-----|
| Chrome | 90+ | 主要支持浏览器 |
| Safari | 14+ | macOS和iOS用户 |
| Firefox | 88+ | 部分用户使用 |
| Edge | 90+ | Windows用户 |

### 6.3 安全性要求

- 所有API请求必须携带用户认证Token，防止未授权访问
- 洞察数据仅对当前用户可见，不允许跨用户访问
- PDF导出的文件不包含敏感的用户标识信息
- 分享链接需要设置过期时间（如7天），防止长期泄露

---

## 七、UI/UX设计要点

### 7.1 设计原则

- **一致性**：网页端与移动端的视觉风格、配色、图标保持一致
- **可读性**：桌面端字号适当增大，行间距增加，确保长文本阅读舒适
- **层次感**：通过卡片、阴影、间距营造清晰的信息层次
- **反馈性**：所有交互操作（点击、悬停、加载）都有明确的视觉反馈

### 7.2 配色方案

| 洞察类型 | 主色调 | 用途 |
|---------|-------|-----|
| 人物关系 | #FF6B6B（红色） | 卡片背景、图标、强调文字 |
| 意识层级 | #FFD700（金色） | 卡片背景、图标、强调文字 |
| 我的成长 | #4ECDC4（青色） | 卡片背景、图标、强调文字 |
| 近期注意 | #FFE66D（黄色） | 卡片背景、图标、强调文字 |
| 内在矛盾 | #95E1D3（绿色） | 卡片背景、图标、强调文字 |

### 7.3 关键页面线框图

#### 洞察入口页面

```
┌─────────────────────────────────────────────────────────┐
│  [Logo]  首页  日记  洞察  设置                 [用户头像] │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  📊 我的洞察                                              │
│  通过AI分析你的日记，获得深度的心理和意识层面的洞察       │
│                                                           │
│  ┌──────────────────┐  ┌──────────────────┐             │
│  │ 🧑‍🤝‍🧑 我的人物关系 │  │ 🎯 我的意识层级  │             │
│  │ 基于社会网络分析  │  │ 基于David Hawkins│             │
│  │ 最近更新：2小时前 │  │ 最近更新：1天前  │             │
│  │        [刷新]     │  │        [刷新]    │             │
│  └──────────────────┘  └──────────────────┘             │
│                                                           │
│  ┌──────────────────┐  ┌──────────────────┐             │
│  │ 🌱 我的成长      │  │ 💡 我近期可以注意│             │
│  │ 基于意识层级     │  │ 基于正念理论     │             │
│  │ 最近更新：3天前  │  │ 最近更新：5小时前│             │
│  │        [刷新]    │  │        [刷新]    │             │
│  └──────────────────┘  └──────────────────┘             │
│                                                           │
│  ┌──────────────────┐                                    │
│  │ 🔄 内在矛盾梳理  │                                    │
│  │ 基于荣格心理学   │                                    │
│  │ 最近更新：2天前  │                                    │
│  │        [刷新]    │                                    │
│  └──────────────────┘                                    │
│                                                           │
└─────────────────────────────────────────────────────────┘
```

#### 洞察详情页面（以"我的成长"为例）

```
┌─────────────────────────────────────────────────────────┐
│  [← 返回]                                      [🔄 刷新] │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  🌱 我的成长                                              │
│  基于David Hawkins意识层级                                │
│                                                           │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ 🧠 查看AI思考过程 ▼                                  │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                           │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ 你当前的意识层级                                     │ │
│  │ 350  接纳                                            │ │
│  │ Hawkins量表                                          │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                           │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ 📈 13天成长轨迹                                      │ │
│  │                                                      │ │
│  │  500 ┤                           ╱●                 │ │
│  │  400 ┤                 ╱                            │ │
│  │  300 ┤       ╱●                                     │ │
│  │  200 ┤  ●                                           │ │
│  │      └──┬────┬────┬────┬────┬────                  │ │
│  │       1/3   1/5   1/8   1/12  1/15                 │ │
│  │                                                      │ │
│  │  起点：恐惧 (280) → 终点：接纳 (350)，提升70分      │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                           │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ 成长旅程                                             │ │
│  │ 你的日记显示，你正在经历一段深刻的内在转化...       │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                           │
│  [导出为PDF]  [分享链接]  [查看历史版本]                │
│                                                           │
└─────────────────────────────────────────────────────────┘
```

---

## 八、项目计划

### 8.1 开发阶段

| 阶段 | 任务 | 预计工期 | 交付物 |
|-----|------|---------|--------|
| **阶段1：需求确认** | 与产品团队确认PRD，细化UI设计稿 | 2天 | 最终PRD、UI设计稿 |
| **阶段2：前端开发** | 开发洞察入口页面、详情页面、图表组件 | 5天 | 可运行的前端页面 |
| **阶段3：后端适配** | 确认API兼容性，开发PDF导出API | 3天 | 后端API文档 |
| **阶段4：联调测试** | 前后端联调，修复bug，性能优化 | 3天 | 可用的网页端洞察功能 |
| **阶段5：用户测试** | 邀请10-20名用户内测，收集反馈 | 3天 | 用户反馈报告 |
| **阶段6：上线发布** | 修复用户反馈的问题，正式上线 | 2天 | 正式版网页端洞察功能 |

**总计**：18天（约3周）

### 8.2 里程碑

- **Day 2**：PRD和UI设计稿确认完成
- **Day 7**：前端页面开发完成，可本地预览
- **Day 10**：后端API适配完成，前后端联调通过
- **Day 13**：内部测试完成，功能稳定
- **Day 16**：用户内测完成，收集反馈
- **Day 18**：正式上线，对外发布

---

## 九、风险与应对

### 9.1 技术风险

| 风险 | 影响 | 概率 | 应对措施 |
|-----|------|------|---------|
| AI生成速度慢，用户等待时间长 | 用户体验差，流失率高 | 中 | 优化prompt，使用更快的AI模型；增加缓存机制 |
| PDF导出质量不佳，图表失真 | 用户无法有效分享洞察 | 中 | 切换到后端生成PDF方案，使用Puppeteer |
| 图表在不同浏览器渲染不一致 | 部分用户看到错误的图表 | 低 | 使用成熟的图表库（Recharts），充分测试 |

### 9.2 产品风险

| 风险 | 影响 | 概率 | 应对措施 |
|-----|------|------|---------|
| 用户对网页端需求不强，使用率低 | 开发投入无法回收 | 中 | 上线前进行用户调研，确认需求；上线后通过数据分析优化 |
| 网页端和移动端功能不一致，用户困惑 | 用户体验割裂 | 低 | 严格保持两端功能和UI一致性，编写详细的设计规范 |

---

## 十、成功指标

### 10.1 核心指标

| 指标 | 目标值 | 说明 |
|-----|-------|-----|
| 网页端洞察功能使用率 | ≥30% | 在所有活跃用户中，使用过网页端洞察功能的占比 |
| 洞察详情页面停留时长 | ≥3分钟 | 用户在洞察详情页面的平均停留时长 |
| PDF导出次数 | ≥10%使用率 | 使用过PDF导出功能的用户占比 |
| 用户满意度 | ≥4.5分（满分5分） | 通过用户调研问卷收集的满意度评分 |

### 10.2 辅助指标

- 洞察刷新次数：平均每用户每周刷新洞察的次数
- 历史版本查看率：查看过洞察历史版本的用户占比
- 分享链接点击率：通过分享链接访问洞察的次数

---

## 十一、附录

### 11.1 术语表

| 术语 | 解释 |
|-----|-----|
| **意识层级** | 基于David Hawkins的意识地图，将人的意识状态量化为20-1000的分数 |
| **正念理论** | 源自佛教禅修，强调对当下的觉知和接纳，由一行禅师等大师推广到西方 |
| **荣格心理学** | 由卡尔·荣格创立的分析心理学，强调整合内在矛盾，实现自我完整 |
| **tRPC** | 一种类型安全的RPC框架，用于前后端通信 |
| **React Query** | React的数据获取和缓存库，简化异步数据管理 |

### 11.2 参考资料

- David Hawkins《Power vs. Force》：意识层级理论的核心著作
- 一行禅师《正念的奇迹》：正念理论的经典入门书
- 卡尔·荣格《心理类型》：荣格心理学的代表作
- React官方文档：https://react.dev
- Chart.js官方文档：https://www.chartjs.org

---

**文档结束**

如有任何疑问或需要进一步细化的内容，请随时联系产品团队。
